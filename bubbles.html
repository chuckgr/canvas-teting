<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bubbles</title>
    <script type="text/javascript" src="animation.js"></script>
    <script type="text/javascript" src="shapes.js"></script>
    <script type="text/javascript">
        //----------------------------------------------------------
        // Create all the shapes we will put on the canvas
        //----------------------------------------------------------
        function createShapes(count) {
            let shapes = [];
            for (let i = 0; i < count; i++) {
                shapes.push(new Circle(Math.floor(Math.random() * canvas.width),
                    Math.floor(Math.random() * canvas.height),
                    Math.floor(Math.random() * 10) + 2));
            }

            return shapes;
        }

        //----------------------------------------------------------
        // Create the animations for the shapes passed
        //----------------------------------------------------------
        function createAnimations(shapes) {
            for (let i = 0; i < shapes.length; i++) {
                shapes[i].addAnimation(new LinearAnimation(
                    Math.floor((Math.random() * 5) + 2),
                    Math.floor((Math.random() * 5) + 2),
                    Math.floor((Math.random() * 5) + 1)));
            }
        }

        //----------------------------------------------------------
        // Draw loop for the shapes created
        //----------------------------------------------------------
        function draw(objects) {
            var canvas = document.getElementById("canvas");
            var context = canvas.getContext("2d");
            context.clearRect(0, 0, context.canvas.width, context.canvas.height);

            for (let i = 0; i < objects.length; i++) {
                objects[i].draw(context);
            }

            context.restore();

            window.requestAnimationFrame(function (ts) {
                //console.log(objects);
                draw(objects);
            });
        }

        //----------------------------------------------------------
        // This is the routine called when the page is loaded
        //----------------------------------------------------------
        function init() {
            // Get the canvas we are drawing to
            var canvas = document.getElementById("canvas");
            var ctx = canvas.getContext("2d");

            objs = [
                new Circle(Math.floor(Math.random() * canvas.width),
                    Math.floor(Math.random() * canvas.height),
                    Math.floor(Math.random() * 10) + 2),
                new Square(Math.random() * canvas.width,
                    Math.floor(Math.random() * canvas.height),
                    Math.floor(Math.random() * 50) + 2)
            ];

            // Add animation to the shapes
            objs[0].addAnimation(new LinearAnimation(5, 5, 5));
            objs[1].addAnimation(new LinearAnimation(2, 2, 2));

            let shapes = createShapes(50);
            createAnimations(shapes);

            window.requestAnimationFrame(function (ts) {
                draw(shapes);
            });
        }

        //----------------------------------------------------------
        // globals
        //----------------------------------------------------------
        //let debug = true;
        let debug = false;

        let locs = [Math.random() * (500 / 2), Math.random() * (500 / 2), Math.random() * (500 / 2)]
    </script>
</head>

<body onload="init()">
    <h3>Shapes moving</h3>
    <canvas id="canvas" width="750" height="500" style="border: solid 3pt rgb(248, 224, 8)"></canvas>
    <p />
</body>

</html>