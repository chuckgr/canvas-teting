<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bubbles</title>
    <script type="text/javascript" src="animation.js"></script>
    <script type="text/javascript" src="shapes.js"></script>
    <script type="text/javascript">
        //----------------------------------------------------------
        // Create all the shapes we will put on the canvas
        //----------------------------------------------------------
        function createShapes(count) {
            let shapes = [];
            let shapeType = Math.round(Math.random() * 2);

            for (let i = 0; i < count; i++) {
                if (shapeType == 1) {
                    shapes.push(new Circle(Math.floor(Math.random() * canvas.width),
                        Math.floor(Math.random() * canvas.height),
                        Math.floor(Math.random() * 20) + 5));
                } else {
                    shapes.push(new Square(Math.floor(Math.random() * canvas.width),
                        Math.floor(Math.random() * canvas.height),
                        Math.floor(Math.random() * 40) + 2));
                }
                shapeType = Math.floor(Math.random() * 5);
            }

            return shapes;
        }

        //----------------------------------------------------------
        // Create the animations for the shapes passed
        //----------------------------------------------------------
        function createAnimations(shapes) {
            for (let i = 0; i < shapes.length; i++) {
                shapes[i].addAnimation(new LinearAnimation(
                    Math.floor((Math.random() * 5) + 2),
                    Math.floor((Math.random() * 5) + 2),
                    Math.floor((Math.random() * 5) + 1)));
            }
        }

        //----------------------------------------------------------
        // Grab the data from the form and update the screen
        //----------------------------------------------------------
        function getForm() {
            //console.log("Count:" + document.getElementById("count").value);
            //alert("Count:" + document.getElementById("count").value);
            count = document.getElementById("count").value;
            init();
        }

        //----------------------------------------------------------
        // Draw loop for the shapes created
        //----------------------------------------------------------
        function draw(objects) {
            var canvas = document.getElementById("canvas");
            var context = canvas.getContext("2d");
            context.clearRect(0, 0, context.canvas.width, context.canvas.height);
            if (debug) {
                context.font = '12px monospace';
                context.fillText("Number of shapes = " + objects.length, 5, 15)
            }

            for (let i = 0; i < objects.length; i++) {
                objects[i].draw(context);
            }

            context.restore();

            window.requestAnimationFrame(function (ts) {
                //console.log(objects);
                draw(objects);
            });
        }

        //----------------------------------------------------------
        // This is the routine called when the page is loaded
        //----------------------------------------------------------
        function init() {
            // Get the canvas we are drawing to
            var canvas = document.getElementById("canvas");
            var ctx = canvas.getContext("2d");

            let shapes = createShapes(count);
            createAnimations(shapes);

            window.requestAnimationFrame(function (ts) {
                draw(shapes);
            });
        }

        //----------------------------------------------------------
        // globals
        //----------------------------------------------------------
        let debug = true;
        //let debug = false;
        let count = 50;

        let locs = [Math.random() * (500 / 2), Math.random() * (500 / 2), Math.random() * (500 / 2)]
    </script>
</head>

<body onload="init()">
    <h3>Shapes moving</h3>
    <div>
        <canvas id="canvas" width="750" height="500" style="border: solid 3pt rgb(248, 224, 8)"></canvas>
    </div>
    <div>
        <form onsubmit="JavaScript:getForm()">
            Number of shapes (1-100):
            <input type="number" id="count" name="max" l min="1" max="100" value="50"> <br><br>
            <input name="Submit" type="submit" value="Update" />
        </form>
    </div>

    <p />
</body>

</html>